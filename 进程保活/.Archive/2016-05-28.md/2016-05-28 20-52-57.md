# 知乎问题：怎么让 Android 程序一直后台运行，像 QQ 一样不被杀死？

来源:[知乎](https://www.zhihu.com/question/29826231)

[TOC]

## 问题
怎么让 Android 程序一直后台运行，像 QQ 一样不被杀死？

我开发了一个应用，由于需求，需要开启许多service许多线程一直运行（刷一些网站数据，挂得越久刷得越多），用户想要的当然是开启后一直挂在后台不管，但是这个应用显然很耗费资源，长时间在后台很容易被Android杀死，就是请问各位大手，有没有什么办法像QQ一样一直在后台跑，或者说怎么提升app权限，要他不那么容易被杀死

## 回答1

> 作者：闭关写代码
> 链接：https://www.zhihu.com/question/29826231/answer/71207109
> 来源：知乎
> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

强烈建议不要这么做，不仅仅从用户角度考虑，作为Android开发者也有责任去维护Android的生态环境。现在很多Android开发工程师，主力机居然是iPhone而不是Android设备，感到相当悲哀。

从技术角度概括一下现在普遍的防杀方法
Service设置成START_STICKY，kill 后会被重启（等待5秒左右），重传Intent，保持与重启前一样
​通过 startForeground将进程设置为前台进程，做前台服务，优先级和前台应用一个级别​，除非在系统内存非常缺，否则此进程不会被 kill
双进程Service：让2个进程互相保护，其中一个Service被清理后，另外没被清理的进程可以立即重启进程
QQ黑科技:在应用退到后台后，另起一个只有 1 像素的页面停留在桌面上，让自己保持前台状态，保护自己不被后台清理工具杀死
在已经root的设备下，修改相应的权限文件，将App伪装成系统级的应用（Android4.0系列的一个漏洞，已经确认可行）
Android系统中当前进程(Process)fork出来的子进程，被系统认为是两个不同的进程。当父进程被杀死的时候，子进程仍然可以存活，并不受影响。鉴于目前提到的在Android-Service层做双守护都会失败，我们可以fork出c进程，多进程守护。死循环在那检查是否还存在，具体的思路如下（Android5.0以下可行）
用C编写守护进程(即子进程)，守护进程做的事情就是循环检查目标进程是否存在，不存在则启动它。
在NDK环境中将1中编写的C代码编译打包成可执行文件(BUILD_EXECUTABLE)。
主进程启动时将守护进程放入私有目录下，赋予可执行权限，启动它即可。
联系厂商，加入白名单
------------------------------------------------------
TIP: 面对各种流氓软件后台常驻问题，建议使用“绿色守护”来解决，可是杀掉那些第三方清理工具难以清除的后台程序